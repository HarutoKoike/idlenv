#!/bin/zsh

IDL_STARTUP_OLD=$IDL_STARTUP
IDL_STARTUP_NEW="${PWD}/idl_startup.pro"


# create idl statup file
if [ ! -f $IDL_STARTUP_NEW ] ; then
  touch $IDL_STARTUP_NEW
  echo "CD, CURRENT=cdir" >> $IDL_STARTUP_NEW
  echo "!PATH='<IDL_DEFAULT>:+' + cdir" >> $IDL_STARTUP_NEW
fi



# renew IDL_STARTUP
export IDL_STARTUP=$IDL_STARTUP_NEW



# create library directory
if [ ! -d lib ] ; then
  mkdir lib
fi



# change prompt
BASE="$(basename ${PWD})"
export PS1_OLD=$PS1
export PS1="(IDL virtual) ${BASE} $ "



# delete IDL_PATH
if [ -n $IDL_PATH ] ; then
  export IDL_PATH_OLD=$IDL_PATH
  unset IDL_PATH
fi




# deactivate virtual environment
function deactivate () {
  export IDL_STARTUP=$IDL_STARTUP_OLD
  export PS1=$PS1_OLD
  export IDL_PATH=$IDL_PATH_OLD
}

